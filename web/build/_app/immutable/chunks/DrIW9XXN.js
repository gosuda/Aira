import{Z as k,s as d,g as e,d as o}from"./CNJltf12.js";function m(){let t=k({token:null,user:null,loading:!0});function s(){if(typeof window>"u"){t.loading=!1;return}const l=localStorage.getItem("aira_token");if(l){t.token=l;try{const a=JSON.parse(atob(l.split(".")[1]));t.user={id:a.sub,email:a.email,name:a.name,role:a.role,tenantId:a.tenant_id}}catch{localStorage.removeItem("aira_token"),t.token=null}}t.loading=!1}function c(l){localStorage.setItem("aira_token",l),t.token=l;try{const a=JSON.parse(atob(l.split(".")[1]));t.user={id:a.sub,email:a.email,name:a.name,role:a.role,tenantId:a.tenant_id}}catch{}}function f(){localStorage.removeItem("aira_token"),t.token=null,t.user=null}return{get token(){return t.token},get user(){return t.user},get loading(){return t.loading},get isAuthenticated(){return t.token!==null},init:s,login:c,logout:f}}const $=m(),S=["backlog","in_progress","review","done"],y={backlog:"Backlog",in_progress:"In Progress",review:"Review",done:"Done"};function w(){let t=d(k([])),s=d(!0),c=d("");async function f(i,u){o(s,!0),o(c,"");try{const n=await fetch(`/api/v1/projects/${i}/tasks`,{headers:{Authorization:`Bearer ${u}`}});if(!n.ok)throw new Error(`Failed to load tasks (${n.status})`);const r=await n.json();o(t,r.tasks??[],!0)}catch(n){o(c,n instanceof Error?n.message:"Failed to load board",!0)}finally{o(s,!1)}}async function l(i,u,n){const r=e(t).find(g=>g.id===i);if(!r||r.status===u)return;const h=r.status;r.status=u;try{if(!(await fetch(`/api/v1/tasks/${i}/transition`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({status:u})})).ok)throw new Error("Transition failed")}catch{r.status=h}}function a(i){const u=e(t).findIndex(n=>n.id===i.id);u>=0?e(t)[u]=i:e(t).push(i)}return{get tasks(){return e(t)},get loading(){return e(s)},get error(){return e(c)},get columns(){return S},get columnLabels(){return y},byStatus(i){return e(t).filter(u=>u.status===i)},load:f,moveTask:l,handleWSUpdate:a}}const I=w();function v(){let t=d(k([])),s=d(!0),c=d(""),f=d(null);async function l(i,u){o(s,!0),o(c,"");try{const n=await fetch(`/api/v1/projects/${i}/adrs`,{headers:{Authorization:`Bearer ${u}`}});if(!n.ok)throw new Error(`Failed to load ADRs (${n.status})`);const r=await n.json();o(t,r.adrs??[],!0)}catch(n){o(c,n instanceof Error?n.message:"Failed to load ADRs",!0)}finally{o(s,!1)}}function a(i){o(f,i,!0)}return{get adrs(){return e(t)},get loading(){return e(s)},get error(){return e(c)},get selected(){return e(f)},load:l,select:a}}const _=v();function b(){let t=d(k([])),s=d(k([])),c=d(null),f=d(!0),l=d("");async function a(r,h){o(f,!0),o(l,"");try{const g=await fetch(`/api/v1/projects/${r}/agents`,{headers:{Authorization:`Bearer ${h}`}});if(!g.ok)throw new Error(`Failed to load sessions (${g.status})`);const p=await g.json();o(t,p.sessions??[],!0)}catch(g){o(l,g instanceof Error?g.message:"Failed to load sessions",!0)}finally{o(f,!1)}}function i(r){o(c,r,!0),o(s,[],!0)}function u(r){e(s).push(r),e(s).length>500&&o(s,e(s).slice(-500),!0)}function n(r){const h=e(t).findIndex(g=>g.id===r.id);h>=0?e(t)[h]=r:e(t).unshift(r)}return{get sessions(){return e(t)},get logs(){return e(s)},get activeSessionId(){return e(c)},get activeSession(){return e(t).find(r=>r.id===e(c))??null},get loading(){return e(f)},get error(){return e(l)},loadSessions:a,selectSession:i,appendLog:u,updateSession:n}}const E=b();export{$ as a,I as b,_ as c,E as d};
